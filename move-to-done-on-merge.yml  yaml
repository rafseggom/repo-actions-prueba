name: Move to Done on PR Merge

on:
  pull_request:
    types: [closed]

jobs:
  move-to-done:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    permissions:
      projects: write
      issues: write
    steps:
    - name: Get linked issue
      id: get_issue
      uses: actions/github-script@v6
      with:
        script: |
          const prBody = context.payload.pull_request.body;
          const issueNumber = prBody.match(/#(\d+)/)?.[1];
          core.setOutput('number', issueNumber || '');

    - name: Move to Done
      if: steps.get_issue.outputs.number != ''
      uses: actions/github-script@v6
      with:
        script: |
          await github.rest.projects.updateCard({
            card_id: context.payload.projects_v2_item.id,
            column_id: 'DONE_COLUMN_ID',  # Reemplazar con tu ID real
            mediaType: { previews: ['inertia'] }
          });